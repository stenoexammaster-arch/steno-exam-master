<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Steno Master - Admin Panel</title>

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/admin-console.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body class="admin-page">
  <header class="navbar">
    <div class="nav-left">
      <img src="assets/logo.png" alt="Logo" class="logo" />
      <span class="brand-name">Steno Master</span>
    </div>
    <nav class="nav-right">
      <a href="index.html">Home</a>
      <a href="practice.html">Practice &amp; Books</a>
      <a href="admin.html">Admin</a>
      <a href="login.html" class="nav-cta">Log in</a>
    </nav>
  </header>

  <main class="admin-main">
    <h1>Admin Panel</h1>
    <div id="admin-warning" class="warning hidden"></div>

    <div id="admin-content" class="hidden">
      <div class="admin-console-shell">
        <!-- Sidebar -->
        <aside class="admin-console-sidebar">
          <div class="acs-brand">
            <div class="acs-dot"></div>
            <div>
              <div class="acs-title">Admin Console</div>
              <div class="acs-sub">Steno Master</div>
            </div>
          </div>

          <nav class="acs-nav">
            <a class="acs-link active" href="#dashboard-section">üìä Dashboard</a>
            <a class="acs-link" href="#books-section">üìö Books &amp; Chapters</a>
            <a class="acs-link" href="#random-section">üé≤ Random Texts</a>

            <!-- ‚úÖ NEW -->
            <a class="acs-link" href="#hardwords-section">üß© Hard Words</a>

            <a class="acs-link" href="#feedback-section">üí¨ Feedback</a>
            <a class="acs-link" href="#users-section">üë§ Users</a>
          </nav>

          <div class="acs-footer">
            <button class="btn small secondary" id="acs-refresh-btn" type="button">‚Üª Refresh</button>
          </div>
        </aside>

        <!-- Main -->
        <div class="admin-console-body">
          <!-- Topbar -->
          <div class="admin-console-topbar">
            <div class="admin-console-search">
              <input id="admin-global-search" type="text" placeholder="Search books, random texts, hard words..." />
            </div>
            <div class="admin-console-actions">
              <span class="admin-user-pill" id="admin-user-pill">Admin</span>
            </div>
          </div>

          <!-- Dashboard -->
          <section class="admin-section" id="dashboard-section">
            <h2>Dashboard</h2>
            <p class="admin-section-description">
              View-only overview. (Payments/Subscriptions will be added later.)
            </p>

            <div class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-label">Total Users</div>
                <div class="kpi-value" id="kpi-users">‚Äî</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Books</div>
                <div class="kpi-value" id="kpi-books">‚Äî</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Random Texts</div>
                <div class="kpi-value" id="kpi-random">‚Äî</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Hard Words</div>
                <div class="kpi-value" id="kpi-hardwords">‚Äî</div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Feedback</div>
                <div class="kpi-value" id="kpi-feedback">‚Äî</div>
              </div>
              <div class="kpi-card kpi-muted">
                <div class="kpi-label">Revenue (future)</div>
                <div class="kpi-value">‚Äî</div>
              </div>
            </div>
          </section>

          <!-- Hero -->
          <section class="admin-section admin-hero">
            <div class="admin-hero-main">
              <h2>Manage books &amp; lessons</h2>
              <p class="admin-section-description">
                Add books, volumes, and chapters/lessons. Control free/paid per chapter.
              </p>
            </div>
            <div class="admin-hero-stats">
              <div class="admin-hero-stat">
                <span class="label">Books</span>
                <span class="value" id="stat-books">‚Äì</span>
              </div>
              <div class="admin-hero-stat">
                <span class="label">Random texts</span>
                <span class="value" id="stat-random">‚Äì</span>
              </div>
              <div class="admin-hero-stat">
                <span class="label">Chapters in book</span>
                <span class="value" id="stat-chapters">‚Äì</span>
              </div>
            </div>
          </section>

          <!-- BOOKS + CHAPTERS -->
          <section class="admin-section" id="books-section">
            <h2>Books &amp; Chapters</h2>
            <p class="admin-section-description">
              Left side se book select karo. Right side me book + volumes + chapters manage karo.
              <br />
              ‚úÖ New: Chapter level Free/Locked + Visible/Hidden controls.
            </p>

            <div class="admin-books-layout">
              <!-- LEFT: BOOK LIST -->
              <aside class="admin-books-sidebar">
                <div class="admin-books-sidebar-top">
                  <span style="font-size:0.85rem;color:#9ca3af;">Books</span>
                  <button id="new-book-btn" class="btn small primary">+ New Book</button>
                </div>
                <div id="books-sidebar-list" class="admin-books-sidebar-list"></div>
              </aside>

              <!-- RIGHT: SELECTED BOOK -->
              <div class="admin-book-pane">
                <div id="book-none">
                  <p style="font-size:0.9rem;color:#9ca3af;">
                    Left side se koi book select karein, ya ‚ÄúNew Book‚Äù button se nayi book banayein.
                  </p>
                </div>

                <div id="book-editor" class="hidden">
                  <!-- Book meta bar -->
                  <div class="book-meta-bar">
                    <div class="book-meta-main">
                      <h3 id="book-meta-title">Book title</h3>
                      <p id="book-meta-subtitle"></p>
                    </div>
                    <div class="book-meta-actions">
                      <button id="book-toggle-visible-btn" class="btn small secondary" type="button">Hide from tests</button>
                      <button id="book-toggle-paid-btn" class="btn small secondary" type="button">Mark as Paid</button>
                      <button id="book-edit-mode-btn" class="btn small" type="button">Edit details</button>
                      <button id="book-delete-btn" class="btn small secondary" type="button">Delete book</button>
                    </div>
                  </div>

                  <!-- Book edit form -->
                  <div id="book-edit-form" class="admin-form hidden">
                    <label for="book-title-input">Book Title</label>
                    <input type="text" id="book-title-input" placeholder="Book title" />

                    <label for="book-language-input">Language</label>
                    <select id="book-language-input">
                      <option value="english">English</option>
                      <option value="hindi-mangal">Hindi (Mangal / Unicode)</option>
                      <option value="hindi-kruti">Hindi (Kruti Dev 010)</option>
                    </select>

                    <label for="book-description-input">Short Description</label>
                    <input type="text" id="book-description-input" placeholder="Visible on books page" />

                    <label for="book-content-input">Default Content / Note</label>
                    <textarea id="book-content-input" placeholder="Optional admin notes"></textarea>

                    <label>
                      <input type="checkbox" id="book-paid-input" />
                      Paid book (preview free, full for subscribers)
                    </label>

                    <!-- ‚úÖ NEW helper -->
                    <label for="book-free-lessons-count" style="margin-top:10px;">Free lessons count (optional helper)</label>
                    <input
                      type="number"
                      id="book-free-lessons-count"
                      class="test-input"
                      placeholder="e.g. 25"
                      min="0"
                    />
                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                      <button id="book-apply-free-lessons-btn" class="btn small secondary" type="button">
                        Apply free count to chapters
                      </button>
                      <span style="font-size:12px;color:#9ca3af;align-self:center;">
                        (Will mark first N ordered chapters as Free and rest Locked)
                      </span>
                    </div>

                    <div class="admin-form-actions">
                      <button id="book-save-btn" class="btn primary" type="button">Save book details</button>
                      <button id="book-cancel-btn" class="btn small secondary" type="button">Cancel</button>
                    </div>
                  </div>

                  <!-- ‚úÖ KEEP VOLUME MANAGER (do not remove) -->
                  <div class="admin-form" style="margin-top:12px;">
                    <div style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;">
                      <div class="control-group" style="flex:1;">
                        <span class="test-label">Volume Filter</span>
                        <select id="volume-select" class="test-select">
                          <option value="__all__">All volumes (show all chapters)</option>
                          <option value="__none__">No volume (standalone chapters)</option>
                        </select>
                      </div>

                      <button id="volume-new-btn" class="btn small primary" type="button">+ New Volume</button>
                      <button id="volume-edit-btn" class="btn small secondary" type="button">Edit Selected Volume</button>
                    </div>

                    <div id="volume-editor" class="hidden" style="margin-top:10px;">
                      <div class="chapter-fields-row">
                        <div class="control-group" style="flex:1;">
                          <span class="test-label">Volume Title</span>
                          <input type="text" id="volume-title-input" class="test-input" placeholder="e.g. Volume 1" />
                        </div>
                        <div class="control-group" style="flex:1;">
                          <span class="test-label">Volume Code (optional)</span>
                          <input type="text" id="volume-code-input" class="test-input" placeholder="e.g. VOL-001" />
                        </div>
                        <div class="control-group" style="max-width:140px;">
                          <span class="test-label">Order</span>
                          <input type="number" id="volume-order-input" class="test-input" placeholder="1" />
                        </div>
                      </div>

                      <div class="admin-form-actions">
                        <button id="volume-save-btn" class="btn primary" type="button">Save Volume</button>
                        <button id="volume-cancel-btn" class="btn small secondary" type="button">Cancel</button>
                        <button id="volume-delete-btn" class="btn small secondary" type="button">Delete Volume</button>
                      </div>

                      <div id="volume-msg" class="auth-error" style="margin-top:6px;"></div>
                    </div>
                  </div>

                  <!-- CHAPTER EDITOR -->
                  <div class="chapter-editor">
                    <h3>Chapters / Lessons</h3>
                    <p class="admin-section-description">
                      ‚úÖ New: Chapter access controls (Visible + Free).
                      (Use this for ‚Äú25 free lessons, rest subscribe‚Äù)
                    </p>

                    <div class="chapter-tools">
                      <input id="chapter-search" class="test-input" placeholder="Search chapters‚Ä¶" />
                      <button id="chapter-bulk-import-btn" class="btn small">Bulk Import</button>
                      <button id="chapter-order-manager-btn" class="btn small secondary">Manage Order</button>
                      <button id="chapter-auto-number-btn" class="btn small secondary">Auto Number</button>
                    </div>

                    <div class="chapter-fields-row">
                      <div class="control-group">
                        <span class="test-label">Chapter code / number</span>
                        <input type="text" id="chapter-code" class="test-input" placeholder="e.g. 001 / 356-I" />
                      </div>
                      <div class="control-group">
                        <span class="test-label">Chapter name</span>
                        <input type="text" id="chapter-name" class="test-input" placeholder="e.g. Lesson Name" />
                      </div>
                      <div class="control-group" style="max-width:140px;">
                        <span class="test-label">Order</span>
                        <input type="number" id="chapter-order" class="test-input" placeholder="1" />
                      </div>
                    </div>

                    <!-- ‚úÖ NEW CHAPTER ACCESS -->
                    <div class="chapter-fields-row" style="gap:14px; margin-top:6px;">
                      <label style="display:flex; gap:10px; align-items:center; font-size:13px; font-weight:700;">
                        <input type="checkbox" id="chapter-visible-input" checked />
                        Visible in tests
                      </label>

                      <label style="display:flex; gap:10px; align-items:center; font-size:13px; font-weight:700;">
                        <input type="checkbox" id="chapter-free-input" checked />
                        Free lesson (uncheck = locked)
                      </label>

                      <span style="font-size:12px; color:#9ca3af;">
                        Tip: Free lessons = show normally. Locked lessons = show ‚ÄúSubscribe for more‚Äù (future on user side).
                      </span>
                    </div>

                    <div class="chapter-fields-row">
                      <div class="control-group">
                        <span class="test-label">Preview font size</span>
                        <input type="range" id="chapter-font-size" min="14" max="26" value="18" />
                      </div>
                      <div class="control-group">
                        <span class="test-label">Existing chapters (volume filtered)</span>
                        <select id="chapter-select" class="test-select">
                          <option value="">New chapter...</option>
                        </select>
                      </div>
                    </div>

                    <div class="chapter-fields-row">
                      <div class="control-group">
                        <span class="test-label">Import text file (.txt)</span>
                        <input type="file" id="chapter-file" accept=".txt" class="test-input" />
                      </div>
                    </div>

                    <textarea id="chapter-content" placeholder="Full passage text here..."></textarea>

                    <div class="admin-form-actions">
                      <button id="chapter-save-btn" class="btn primary" type="button">Save chapter</button>
                      <button id="chapter-new-btn" class="btn small secondary" type="button">New empty</button>
                      <button id="chapter-delete-btn" class="btn small secondary" type="button">Delete chapter</button>
                    </div>

                    <div id="chapters-message" class="auth-error" style="margin-top:6px;"></div>
                    <div class="chapter-list" id="chapter-list"></div>
                  </div>

                </div>
              </div>
            </div>
          </section>

          <!-- RANDOM TEXTS -->
          <section class="admin-section" id="random-section">
            <h2>Random Texts (Quick Practice)</h2>
            <p class="admin-section-description">
              Random texts used in typing test setup.
            </p>

            <div class="admin-toolbar-row">
              <select id="rt-filter-language" class="test-select">
                <option value="all">All languages</option>
                <option value="english">English</option>
                <option value="hindi-mangal">Hindi (Mangal)</option>
                <option value="hindi-kruti">Hindi (Kruti)</option>
              </select>

              <select id="rt-filter-free" class="test-select">
                <option value="all">All</option>
                <option value="free">Free</option>
                <option value="locked">Locked</option>
              </select>

              <input id="rt-search" class="test-input" placeholder="Search title/text..." />
            </div>

            <div class="admin-columns">
              <div>
                <div class="admin-form">
                  <label for="rt-title">Title</label>
                  <input type="text" id="rt-title" placeholder="e.g. Random English #1" />

                  <label for="rt-language">Language</label>
                  <select id="rt-language">
                    <option value="english">English</option>
                    <option value="hindi-mangal">Hindi (Mangal / Unicode)</option>
                    <option value="hindi-kruti">Hindi (Kruti Dev 010)</option>
                  </select>

                  <label for="rt-text">Text (Main)</label>
                  <textarea id="rt-text" placeholder="Full paragraph text here..."></textarea>

                  <button id="rt-advanced-toggle" class="btn small secondary" type="button">Advanced options</button>

                  <div id="rt-advanced-wrap" class="hidden" style="margin-top:6px;">
                    <label for="rt-code">Code / ID (optional, no spaces)</label>
                    <input type="text" id="rt-code" placeholder="e.g. en-random-1" />

                    <label>
                      <input type="checkbox" id="rt-free" checked />
                      Free random text (available to all users)
                    </label>
                  </div>

                  <div class="admin-form-actions">
                    <button id="rt-add-btn" class="btn primary" type="button">Add Random Text</button>
                    <button id="rt-cancel-btn" class="btn small secondary hidden" type="button">Cancel edit</button>
                  </div>

                  <div id="rt-message" class="auth-error" style="margin-top:6px;"></div>
                </div>
              </div>

              <div>
                <h3 style="margin-bottom:6px;">Existing Random Texts</h3>
                <div id="rt-list" class="books-list"></div>
                <div class="admin-form-actions" style="margin-top:12px;">
                  <button id="rt-load-more" class="btn small secondary" type="button">Load more</button>
                </div>
              </div>
            </div>
          </section>

          <!-- ‚úÖ HARD WORDS -->
          <section class="admin-section" id="hardwords-section">
            <h2>Hard Words</h2>
            <p class="admin-section-description">
              Add hard words for practice. (Stored in Firestore collection: <b>hardWords</b>)
            </p>

            <div class="admin-toolbar-row">
              <select id="hw-filter-lang" class="test-select">
                <option value="all">All languages</option>
                <option value="english">English</option>
                <option value="hindi-mangal">Hindi (Mangal)</option>
                <option value="hindi-kruti">Hindi (Kruti)</option>
              </select>

              <select id="hw-filter-diff" class="test-select">
                <option value="all">All difficulty</option>
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard" selected>Hard</option>
              </select>

              <input id="hw-search" class="test-input" placeholder="Search words..." />
            </div>

            <div class="admin-columns">
              <div>
                <div class="admin-form">
                  <label for="hw-language">Language</label>
                  <select id="hw-language">
                    <option value="english">English</option>
                    <option value="hindi-mangal">Hindi (Mangal / Unicode)</option>
                    <option value="hindi-kruti">Hindi (Kruti Dev 010)</option>
                  </select>

                  <label for="hw-difficulty">Difficulty</label>
                  <select id="hw-difficulty">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard" selected>Hard</option>
                  </select>

                  <label for="hw-tags">Tags (comma separated)</label>
                  <input id="hw-tags" type="text" placeholder="e.g. legal, accounts, exam" />

                  <label for="hw-words">Words (comma or new line separated)</label>
                  <textarea id="hw-words" placeholder="word1, word2 or one per line"></textarea>

                  <div class="admin-form-actions">
                    <button id="hw-add-btn" class="btn primary" type="button">Add Words</button>
                    <button id="hw-clear-btn" class="btn small secondary" type="button">Clear</button>
                  </div>

                  <div id="hw-msg" class="auth-error" style="margin-top:6px;"></div>
                </div>
              </div>

              <div>
                <h3 style="margin-bottom:6px;">Existing Hard Words</h3>
                <div id="hw-list" class="books-list"></div>
                <div class="admin-form-actions" style="margin-top:12px;">
                  <button id="hw-load-more" class="btn small secondary" type="button">Load more</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Feedback -->
          <section class="admin-section" id="feedback-section">
            <h2>Feedback</h2>
            <p class="admin-section-description">View feedback (actions can be added later).</p>
            <div class="admin-table-wrap">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Email</th>
                    <th>Page</th>
                    <th>Message</th>
                    <th>Status</th>
                    <th style="width:160px;">Actions</th>
                  </tr>
                </thead>
                <tbody id="fb-tbody">
                  <tr><td colspan="6" class="td-muted">Load modules to enable‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- Users (view-only) -->
          <section class="admin-section" id="users-section">
            <h2>Users</h2>
            <p class="admin-section-description">
              View-only. (For now, role/plan changes from Firestore directly.)
            </p>
            <div class="admin-table-wrap">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>UID</th><th>Role</th><th>Plan</th><th>Created</th><th>Actions</th>
                  </tr>
                </thead>
                <tbody id="u-tbody">
                  <tr><td colspan="5" class="td-muted">Load modules to enable‚Ä¶</td></tr>
                </tbody>
              </table>
            </div>
          </section>

        </div>
      </div>
    </div>
  </main>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script src="js/firebase-config.js"></script>

  <!-- Optional modules -->
  <script src="js/admin-ui.js"></script>
  <script src="js/admin-dashboard.js"></script>
  <script src="js/admin-feedback.js"></script>
  <script src="js/admin-users.js"></script>

  <!-- Main admin -->
  <script src="js/admin.js"></script>

  <!-- Hard words -->
  <script src="js/admin-hardwords.js"></script>
</body>
</html>